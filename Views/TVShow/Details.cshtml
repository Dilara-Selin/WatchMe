@model WatchMe.Models.TVShow

@{
    ViewData["Title"] = Model?.Title ?? "TV Show Details";
}

<div class="tvshow-details-container">
    <h1>@Model.Title</h1>
    <p>@Model.Overview</p>

    <h3>Genres:</h3>
    <ul>
        @foreach (var genre in Model.TVShowGenres.Select(mg => mg.Genre))
        {
            <li>@genre?.Name</li>
        }
    </ul>

    <h3>Actions:</h3>
    <form method="post" asp-action="LikeTVShow" asp-route-tvShowId="@Model.TVShowId">
        <button type="submit" class="btn btn-success">Like</button>
    </form>

    <form method="post" asp-action="DislikeTVShow" asp-route-tvShowId="@Model.TVShowId">
        <button type="submit" class="btn btn-danger">Dislike</button>
    </form>

    <form method="post" asp-action="AddToWatchList">
        <input type="hidden" name="tvShowId" value="@Model.TVShowId" />
        <button type="submit" class="btn btn-warning">Mark as Watched</button>
    </form>

    <h3>Comments:</h3>
    <ul>
        @foreach (var comment in Model.TVShowComments)
        {
            <li>
                <strong>@comment.User?.Nickname</strong>: @comment.Comment
            </li>
        }
    </ul>

    <h3>Add a Comment:</h3>
    <form method="post" asp-action="AddComment">
        <input type="hidden" name="tvShowId" value="@Model.TVShowId" />
        <textarea name="comment" placeholder="Write your comment..."></textarea>
        <button type="submit" class="btn btn-primary">Add Comment</button>
    </form>

    <!-- Yorumları Listele ve Güncelleme/Silme Butonları -->
    @foreach (var comment in Model.TVShowComments)
    {
        <div class="comment">
            <p>@comment.User.Nickname: @comment.Comment</p>

            @if (comment.UserId == 1) // Kullanıcı sadece kendi yorumunu silebilir veya güncelleyebilir
            {
                <!-- Silme Formu -->
                <form method="post" action="@Url.Action("DeleteComment", "TVShow", new { commentId = comment.TVShowCommentId, tvShowId = Model.TVShowId })">
                    <button type="submit" class="btn btn-danger btn-sm">Sil</button>
                </form>

                <!-- Güncelleme Formu -->
                <form method="post" action="@Url.Action("UpdateComment", "TVShow", new { commentId = comment.TVShowCommentId, tvShowId = Model.TVShowId })">
                    <input type="text" name="newComment" value="@comment.Comment" class="form-control" />
                    <button type="submit" class="btn btn-warning btn-sm">Güncelle</button>
                </form>
            }
        </div>
    }
</div>
